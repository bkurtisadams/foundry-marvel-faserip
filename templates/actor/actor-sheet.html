<form class="{{cssClass}} flexcol" autocomplete="off">
    <header class="sheet-header">
        <div class="header-flex-container">
            <!-- Left Side -->
            <div class="header-left">
                <img src="systems/marvel-faserip/assets/marvel-logo-bw.png" class="marvel-logo"/>
                <div class="field-group">
                    <label class="input-label">Hero's Name</label>
                    <input type="text" name="system.biography.heroName" value="{{actor.system.biography.heroName}}"/>
                </div>
                <div class="field-group">
                    <label class="input-label">Hero's Identity</label>
                    <input type="text" name="system.biography.realName" value="{{actor.system.biography.realName}}"/>
                    <div class="identity-controls">
                        <label><input type="radio" name="system.biography.identity" value="secret" {{#if (eq actor.system.biography.identity "secret")}}checked{{/if}}> Secret</label>
                        <label><input type="radio" name="system.biography.identity" value="public" {{#if (eq actor.system.biography.identity "public")}}checked{{/if}}> Public</label>
                    </div>
                </div>
            </div>

            <!-- Right Side -->
            <div class="header-right">
                <div class="field-group">
                    <label class="input-label">Player Name</label>
                    <input type="text" name="system.biography.playerName" value="{{actor.system.biography.playerName}}"/>
                </div>
                <div class="field-group">
                    <label class="input-label">Group Affiliation</label>
                    <input type="text" name="system.biography.groupAffiliation" value="{{actor.system.biography.groupAffiliation}}"/>
                </div>
                <div class="field-group">
                    <label class="input-label">Base of Operations</label>
                    <input type="text" name="system.biography.baseOfOperations" value="{{actor.system.biography.baseOfOperations}}"/>
                </div>
                <div class="header-bottom-row">
                    <div class="field-group age-field">
                        <label class="input-label">Age</label>
                        <input type="text" name="system.biography.age" value="{{actor.system.biography.age}}"/>
                    </div>
                    <div class="field-group origin-field">
                        <label class="input-label">Origin</label>
                        <input type="text" name="system.biography.origin" value="{{actor.system.biography.origin}}"/>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <section class="sheet-body">
        <div class="abilities-grid">
            <div class="primary-abilities">
                <h2>Primary Abilities</h2>
                <table>
                    <thead>
                        <tr>
                            <th></th>
                            <th>Init Roll</th>
                            <th>Init Rank</th>
                            <th>Current Rank</th>
                            <th>Num</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each actor.system.primaryAbilities as |ability key|}}
                        <tr class="ability-row" data-ability="{{key}}">
                            <td class="ability-label">{{key}}</td>
                            <td><input type="text" class="initial-roll-input" name="system.primaryAbilities.{{key}}.initialRoll" value="{{ability.initialRoll}}" data-ability="{{key}}" maxlength="3"/></td>
                            <td>
                                <select class="initial-rank-select" name="system.primaryAbilities.{{key}}.initialRank" data-ability="{{key}}">
                                    {{selectOptions @root.config.ranks selected=ability.initialRank blank=""}}
                                </select>
                            </td>
                            <td>
                                <select name="system.primaryAbilities.{{key}}.rank" class="rank-select" data-ability="{{key}}">
                                    {{selectOptions @root.config.ranks selected=ability.rank blank=""}}
                                </select>
                            </td>
                            <td><input type="number" class="ability-number" name="system.primaryAbilities.{{key}}.number" value="{{ability.number}}" data-ability="{{key}}" /></td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
            
            <div class="secondary-abilities">
                <h2>Secondary Abilities</h2>
                <div class="secondary-grid">
                    <div class="ability-block">
                        <label>Health (F+A+S+E)</label>
                        <div class="value-pair">
                            <input type="number" name="system.secondaryAbilities.health.value" value="{{actor.system.secondaryAbilities.health.value}}"/>
                            <span>/</span>
                            <input type="number" name="system.secondaryAbilities.health.max" value="{{actor.system.secondaryAbilities.health.max}}" disabled/>
                        </div>
                    </div>
                    
                    <div class="ability-block">
                        <label>Karma (R+I+P)</label>
                        <div class="value-pair">
                            <input type="number" name="system.secondaryAbilities.karma.value" value="{{actor.system.secondaryAbilities.karma.value}}"/>
                            <span>/</span>
                            <input type="number" name="system.secondaryAbilities.karma.max" value="{{actor.system.secondaryAbilities.karma.max}}" disabled/>
                        </div>
                    </div>

                    <div class="ability-block">
                        <label>Resources</label>
                        <input type="number" name="system.secondaryAbilities.resources.number" value="{{actor.system.secondaryAbilities.resources.number}}"/>
                    </div>

                    <div class="popularity-block">
                        <div class="popularity-labels">
                            <label class="clickable-popularity" data-popularity-type="hero">Hero Popularity</label>
                            <label class="clickable-popularity" data-popularity-type="secret">Secret ID Popularity</label>
                        </div>
                        <div class="popularity-inputs">
                            <input type="number" name="system.secondaryAbilities.popularity.hero" value="{{actor.system.secondaryAbilities.popularity.hero}}"/>
                            <input type="number" name="system.secondaryAbilities.popularity.secret" value="{{actor.system.secondaryAbilities.popularity.secret}}"/>
                        </div>                    </div>
                </div>
            </div>
        </div>

        <div class="special-abilities">
            <div class="abilities-header">
                <span>Special Abilities (Powers/Equipment/Stunts)</span>
            </div>
            <button type="button" class="add-power add-ability-button">+ Add Special Ability</button>
            <div class="powers-list">
                {{#each actor.system.powers.list as |power idx|}}
                <div class="power-row">
                    <input type="text" name="system.powers.list.{{idx}}.name" value="{{power.name}}"/>
                    <div class="power-controls">
                        <select name="system.powers.list.{{idx}}.rank" class="rank-select">
                            {{selectOptions @root.config.ranks selected=power.rank blank=""}}
                        </select>
                        <button type="button" class="item-delete" data-type="powers" data-id="{{idx}}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                {{/each}}
            </div>
        </div>

        <div class="bottom-grid">
            <div class="talents-box">
                <div class="list-header">
                    <button type="button" class="add-talent add-button">+ Add Talent</button>
                </div>
                <div class="talents-list">
                    {{#each actor.system.talents.list as |talent idx|}}
                    <div class="list-row">
                        <input type="text" name="system.talents.list.{{idx}}.name" value="{{talent.name}}"/>
                        <button type="button" class="item-delete" data-type="talents" data-id="{{idx}}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    {{/each}}
                </div>
            </div>

            <div class="karma-section">
                <div class="karma-box">
                    <h2>Advancement Fund</h2>
                    <input type="number" name="system.karmaTracking.advancementFund" value="{{actor.system.karmaTracking.advancementFund}}"/>
                    
                    <h2>Karma Pool</h2>
                    <input type="number" name="system.karmaTracking.karmaPool" value="{{actor.system.karmaTracking.karmaPool}}"/>
                </div>
            </div>

            <div class="contacts-box">
                <div class="list-header">
                    <button type="button" class="add-contact add-button">+ Add Contact</button>
                </div>
                <div class="contacts-list">
                    {{#each actor.system.contacts.list as |contact idx|}}
                    <div class="list-row">
                        <input type="text" name="system.contacts.list.{{idx}}.name" value="{{contact.name}}"/>
                        <button type="button" class="item-delete" data-type="contacts" data-id="{{idx}}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    {{/each}}
                </div>
            </div>
        </div>
    </section>
</form>